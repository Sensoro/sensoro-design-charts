"use strict";(self.webpackChunksensoro_design_charts=self.webpackChunksensoro_design_charts||[]).push([["2047"],{65843:function(e,t,l){l.r(t),l.d(t,{default:()=>C});var r=l(52676),n=l(89851),a=l(75271);function o(e,t,l){if("function"==typeof l.getChildrenKey){let r=l.getChildrenKey(e,t);if(null!=r)return r}return l.childrenKey}let i=(e,t,l)=>{t(e,l);let r=o(e,l,l),n=e[r];if(n&&Array.isArray(n)){let r={...l,parents:[...l.parents,e],depth:l.depth+1};n.forEach(e=>{i(e,t,r)})}},s=(e,t,l)=>{let r=o(e,l,l),n=e[r];if(n&&Array.isArray(n)){let r={...l,parents:[...l.parents,e],depth:l.depth+1};n.forEach(e=>{s(e,t,r)})}t(e,l)},u={pre:i,post:s,breadth:(e,t,l)=>{let r=[{tree:e,options:l}],n=()=>{if(0===r.length)return;let e=r.shift(),l=e.tree,a=o(l,e.options,e.options);if(l[a]&&Array.isArray(l[a])){let t={...e.options,parents:[...e.options.parents,l],depth:e.options.depth+1},n=l[a].map(e=>({tree:e,options:t}));r.push(...n)}t(l,e.options),n()};n()}},d=(e,t,l)=>{let r;let n=o(e,l,l),a=t(e,l),i=e[n];if(i&&Array.isArray(i)){let n={...l,parents:[...l.parents,e],depth:l.depth+1};r=i.map(e=>d(e,t,n))}return{...a,[n]:r}},p=(e,t,l)=>{let r;let n=o(e,l,l),a=e[n];if(a&&Array.isArray(a)){let n={...l,parents:[...l.parents,e],depth:l.depth+1};r=a.map(e=>p(e,t,n))}return{...t(e,l),[n]:r}},h=(e,t,l)=>{let r;if(!t(e,l))return;let n=o(e,l,l),a=e[n];return a&&Array.isArray(a)&&(r=a.map(r=>h(r,t,{...l,parents:[...l.parents,e],depth:l.depth+1})).filter(e=>!!e)),{...e,[n]:r}},c=(e,t,l)=>{let r;let n=o(e,l,l),a=e[n];if(a&&Array.isArray(a)&&(r=a.map(r=>c(r,t,{...l,parents:[...l.parents,e],depth:l.depth+1})).filter(e=>!!e)),t(e,l))return{...e,[n]:r}},f=(e,t,l)=>{if(t(e,l))return e;let r=o(e,l,l),n=e[r];if(n&&Array.isArray(n))for(let r=0,a=n.length;r<a;r++){let a=f(n[r],t,{...l,parents:[...l.parents,e],depth:l.depth+1});if(a)return a}},v=(e,t,l)=>{let r=o(e,l,l),n=e[r];if(n&&Array.isArray(n))for(let r=0,a=n.length;r<a;r++){let a=v(n[r],t,{...l,parents:[...l.parents,e],depth:l.depth+1});if(a)return a}if(t(e,l))return e},y={pre:f,post:v,breadth:(e,t,l)=>{let r=[{tree:e,options:l}],n=()=>{if(0===r.length)return;let e=r.shift(),l=e.tree,a=o(l,e.options,e.options);if(l[a]&&Array.isArray(l[a])){let t=l[a].map(t=>({tree:t,options:{...e.options,parents:[...e.options.parents,l],depth:e.options.depth+1}}));r.push(...t)}return t(l,e.options)?l:n()};return n()}};var m={foreach:function(e,t,l){var r,n;let a=null!=(r=null==l?void 0:l.childrenKey)?r:"children",o=null!=(n=null==l?void 0:l.strategy)?n:"pre",i=null==l?void 0:l.getChildrenKey,s=Array.isArray(e),d=u[o],p={childrenKey:a,depth:0,parents:[],getChildrenKey:i};s?e.forEach(e=>{d(e,t,p)}):d(e,t,p)}};let g=[{nodes:[{name:"今日巡航次数",value:160,total:1087875,children:[{name:"公共安全",value:40,total:287875,children:[{name:"紧急响应",value:10,total:18764,children:[{name:"暴力行为",value:10,total:1864},{name:"突发状况",value:10,total:1864}]},{name:"异常跟踪",value:10,total:22329},{name:"持续监测",value:10,total:43093},{name:"巡航正常",value:10,total:763875}]},{name:"交通安全",value:40,total:200653,children:[{name:"紧急响应",value:10,total:18764,children:[{name:"暴力行为",value:10,total:1864},{name:"突发状况",value:10,total:1864}]},{name:"异常跟踪",value:10,total:22329},{name:"持续监测",value:10,total:43093},{name:"巡航正常",value:10,total:763875}]},{name:"市容市政",value:40,total:406765,children:[{name:"紧急响应",value:10,total:18764},{name:"异常跟踪",value:10,total:22329},{name:"持续监测",value:10,total:43093},{name:"巡航正常",value:10,total:763875}]},{name:"城市秩序",value:40,total:82854,children:[{name:"紧急响应",value:10,total:18764},{name:"异常跟踪",value:10,total:22329},{name:"持续监测",value:10,total:43093},{name:"巡航正常",value:10,total:763875}]}]}]}],b=["#423CD1","#E7474D","#E7AF2C","#51C2E1","#3AC583"],A={紧急响应:b[1],异常跟踪:b[2],持续监测:b[3],巡航正常:b[4]};function k(e){let{style:t}=e;return(0,r.jsx)("div",{style:{position:"absolute",width:"100px",visibility:"hidden",backdropFilter:"blur(20px)",background:"rgba(49,64,89,0.35)",padding:16,top:0,left:0,...t},children:"我是 Tooltip"})}m.foreach(g[0].nodes,e=>{let t=e.name;A[t]||(A[t]=b[0])});let C=function(){let e=a.useRef(["公共安全","交通安全","市容市政","城市秩序"]),t=a.useRef(null),l=a.useRef(),o=a.useRef(null),[i,s]=a.useState({}),[u,d]=a.useState(!1),p=a.useCallback(e=>e.name,[]),h=a.useCallback(e=>0===e.depth?160:1===e.depth||2===e.depth?40:20,[]),c=a.useCallback((e,t)=>0===t.depth?40:1===t.depth?10:20,[]),f=a.useCallback(e=>2!==e.depth?b[0]:A[e.key],[]),v=a.useCallback(e=>[2,3].includes(e.parents.length)?{gradient:"linear",x0:.1,y0:1,x1:1,y1:1,stops:[{offset:0,color:A[null==e?void 0:e.source]||b[0]},{offset:1,color:A[null==e?void 0:e.target]||b[0]}]}:b[0],[]),y=a.useCallback((e,t)=>{var l;return`${null==t?void 0:t.name} ${null==t?void 0:null===(l=t.total)||void 0===l?void 0:l.toLocaleString()}`},[]),C=()=>{let e=t.current;o.current&&(clearInterval(o.current),o.current=null),o.current&&clearInterval(o.current),e&&e.setHovered(null),d(!1)},x=()=>{let l=t.current;if(!l)return;let r=e.current;C(),o.current=setInterval(()=>{let e=function(e){if(0===e.length)return null;let t=Math.floor(Math.random()*e.length);return e[t]}(r);e&&l.setHovered([{name:e}])},2e3),d(!0)},E=()=>{C()},F=()=>{x()};return a.useEffect(()=>(l.current=setTimeout(()=>{console.log(t.current);let e=t.current;e&&(x(),e.on("pointerenter",{level:"chart"},E),e.on("pointerleave",{level:"chart"},F),e.setTooltipHandler({showTooltip:(e,t,l)=>{if(s(e=>({...e,left:l.event.x+30,top:l.event.y+30})),!l.changePositionOnly)return s(e=>({...e,visibility:"visible"})),0},hideTooltip:()=>(s(e=>({...e,visibility:"hidden"})),0),release:()=>{}}))},500),()=>{t.current&&(t.current.off("pointerenter",E),t.current.off("pointerleave",F)),l.current&&clearTimeout(l.current),C()}),[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.bQ,{height:600,data:[{id:"sankey-data",values:g}],color:{type:"ordinal",range:b,domain:[],specified:A},categoryField:"name",valueField:"value",nodeAlign:"left",nodeWidth:4,nodeKey:p,nodeHeight:h,linkHeight:c,node:{style:{boundsPadding:[0,20,0,20],fill:f}},link:{style:{fillOpacity:.3,fill:v},state:{selected:{fillOpacity:1}}},label:{visible:!0,offset:-12,formatMethod:y,style:{fill:"#F6F9FE",fontSize:12}},emphasis:{enable:!0,trigger:"hover",effect:u?"adjacency":"related"},ref:t,onClick:e=>{var l;if((null===(l=e.node)||void 0===l?void 0:l.type)==="rect"){let{datum:l}=e,r=t.current;if(!r)return;l.children||(console.log(e),m.foreach(g[0].nodes,e=>{l.datum.name===e.name&&(e.children=[{name:"测试节点",value:5,total:1e3}])}),r.updateData("sankey-data",g))}},onDblClick:e=>{console.log(e)}}),(0,r.jsx)(k,{style:i})]})}}}]);