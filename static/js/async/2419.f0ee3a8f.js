"use strict";(self.webpackChunksensoro_design_charts=self.webpackChunksensoro_design_charts||[]).push([["2419"],{20216:function(n,e,t){t.r(e),t.d(e,{default:()=>c});var a=t(52676),l=t(40453),o=t(55457),r=t(49204),i=t(74469);function s(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",pre:"pre",code:"code"},(0,l.ah)(),n.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h1,{id:"桑基图",children:[(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#桑基图",children:"#"}),"桑基图"]}),"\n",(0,a.jsxs)(e.h2,{id:"自定义颜色",children:[(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义颜色",children:"#"}),"自定义颜色"]}),"\n",(0,a.jsxs)(i.Z,{isMobile:"false",demoId:"_demos_config_Sankey_1",children:[(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-tsx",children:"import type { IVChart, SankeyProps } from '@sensoro-design/chart';\nimport { Sankey } from '@sensoro-design/chart';\nimport React from 'react';\nimport { foreach } from 'tree-lodash';\n\n/**\n * 从数组获取随机数\n * @param arr\n */\nfunction getRandomElement<T = any>(arr: T[]) {\n  if (arr.length === 0) {\n    return null;\n  }\n  const randomIndex = Math.floor(Math.random() * arr.length);\n  return arr[randomIndex];\n}\n\nconst values = [\n  {\n    nodes: [\n      {\n        name: '今日巡航次数',\n        value: 160,\n        total: 1087875,\n        children: [\n          {\n            name: '公共安全',\n            value: 40,\n            total: 287875,\n            children: [\n              { name: '高风险', value: 10, total: 18764 },\n              { name: '中风险', value: 10, total: 22329 },\n              { name: '低风险', value: 10, total: 43093 },\n              { name: '无风险', value: 10, total: 763875 },\n            ],\n          },\n          {\n            name: '交通安全',\n            value: 40,\n            total: 200653,\n            children: [\n              { name: '高风险', value: 10, total: 18764 },\n              { name: '中风险', value: 10, total: 22329 },\n              { name: '低风险', value: 10, total: 43093 },\n              { name: '无风险', value: 10, total: 763875 },\n            ],\n          },\n          {\n            name: '市容市政',\n            value: 40,\n            total: 406765,\n            children: [\n              { name: '高风险', value: 10, total: 18764 },\n              { name: '中风险', value: 10, total: 22329 },\n              { name: '低风险', value: 10, total: 43093 },\n              { name: '无风险', value: 10, total: 763875 },\n            ],\n          },\n          {\n            name: '城市秩序',\n            value: 40,\n            total: 82854,\n            children: [\n              { name: '高风险', value: 10, total: 18764 },\n              { name: '中风险', value: 10, total: 22329 },\n              { name: '低风险', value: 10, total: 43093 },\n              { name: '无风险', value: 10, total: 763875 },\n            ],\n          },\n        ],\n      },\n    ],\n  },\n];\n\nconst colors = ['#423CD1', '#E7474D', '#E7AF2C', '#51C2E1', '#3AC583'];\nconst specified = {\n  今日巡航次数: colors[0],\n  公共安全: colors[0],\n  交通安全: colors[0],\n  市容市政: colors[0],\n  城市秩序: colors[0],\n  高风险: colors[1],\n  中风险: colors[2],\n  低风险: colors[3],\n  无风险: colors[4],\n};\n\nfunction Tooltip(props: { style?: React.CSSProperties }) {\n  const { style } = props;\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        width: '100px',\n        visibility: 'hidden',\n        backdropFilter: 'blur(20px)',\n        background: 'rgba(49,64,89,0.35)',\n        padding: 16,\n        top: 0,\n        left: 0,\n        ...style,\n      }}\n    >\n      我是 Tooltip\n    </div>\n  );\n}\n\nfunction Example() {\n  const chartRef = React.useRef<IVChart>(null);\n  const timeoutRef = React.useRef<NodeJS.Timeout>();\n  const intervalRef = React.useRef<NodeJS.Timeout>();\n  const [tooltipStyles, setTooltipStyles] = React.useState<React.CSSProperties>({});\n\n  const spec: SankeyProps = {\n    height: 600,\n    data: [\n      {\n        values,\n      },\n    ],\n    color: {\n      type: 'ordinal',\n      range: colors,\n      domain: [],\n      specified,\n    },\n    categoryField: 'name',\n    valueField: 'value',\n    nodeAlign: 'left',\n    nodeWidth: 4,\n    // 可通过此参数调整同一层中两个节点之间的间隙大小\n    // nodeGap: 100,\n    nodeKey(datum) {\n      // @ts-expect-error 忽略报错\n      return datum.name;\n    },\n    nodeHeight(node) {\n      return node.depth === 0 ? 160 : 40;\n    },\n    label: {\n      visible: true,\n      offset: 8,\n      formatMethod(_, datum) {\n        return `${datum?.name} ${datum?.total?.toLocaleString()}`;\n      },\n      style: {\n        fill: '#F6F9FE',\n        fontSize: 12,\n      },\n    },\n\n    link: {\n      style: {\n        fillOpacity: 0.3,\n        fill(datum) {\n          // @ts-expect-error 忽略报错\n          const start = specified[datum?.source];\n          // @ts-expect-error 忽略报错\n          const end = specified[datum?.target];\n          return {\n            gradient: 'linear',\n            x0: 0.2,\n            y0: 0.5,\n            x1: 1,\n            y1: 1,\n            stops: [\n              {\n                offset: 0,\n                color: start,\n              },\n              {\n                offset: 1,\n                color: end,\n              },\n            ],\n          };\n        },\n      },\n      state: {\n        selected: {\n          fillOpacity: 1,\n        },\n      },\n    },\n    emphasis: {\n      enable: true,\n      trigger: 'hover',\n      effect: 'related',\n    },\n  };\n\n  const startAutoHover = () => {\n    const chart = chartRef.current;\n    const names: string[] = [];\n\n    foreach(\n      values[0].nodes,\n      (item) => {\n        const name = item.name as unknown as string;\n        if (!names.includes(name) && name !== '今日巡航次数') {\n          names.push(name);\n        }\n      },\n      {\n        strategy: 'breadth',\n      },\n    );\n\n    if (!chart)\n      return;\n\n    intervalRef.current = setInterval(() => {\n      const name = getRandomElement(names);\n\n      if (name) {\n        chart.setHovered([\n          {\n            name,\n          },\n        ]);\n      }\n    }, 2 * 1000);\n  };\n\n  const closeAutoHover = () => {\n    const chart = chartRef.current;\n\n    intervalRef.current && clearInterval(intervalRef.current);\n    if (chart) {\n      chart.setHovered(null);\n    }\n  };\n\n  React.useEffect(\n    () => {\n      timeoutRef.current = setTimeout(() => {\n        // eslint-disable-next-line no-console\n        console.log(chartRef.current);\n\n        const chart = chartRef.current;\n\n        if (!chart)\n          return;\n\n        startAutoHover();\n\n        chart.setTooltipHandler({\n          showTooltip: (activeType, data, params) => {\n            // console.log(activeType, data, params);\n            setTooltipStyles((prev) => {\n              return {\n                ...prev,\n                left: params.event.x + 30,\n                top: params.event.y + 30,\n              };\n            });\n\n            if (params.changePositionOnly) {\n              return;\n            }\n\n            setTooltipStyles((prev) => {\n              return {\n                ...prev,\n                visibility: 'visible',\n              };\n            });\n\n            return 0;\n          },\n          hideTooltip: () => {\n            setTooltipStyles((prev) => {\n              return {\n                ...prev,\n                visibility: 'hidden',\n              };\n            });\n\n            return 0;\n          },\n          release: () => {},\n        });\n      }, 500);\n\n      return () => {\n        timeoutRef.current && clearTimeout(timeoutRef.current);\n        closeAutoHover();\n      };\n    },\n    [],\n  );\n\n  return (\n    <>\n      <Sankey\n        {...spec}\n        skipFunctionDiff\n        ref={chartRef}\n      />\n      <Tooltip style={tooltipStyles} />\n    </>\n  );\n};\n\nexport default Example;\n"})})}),(0,a.jsx)(o.default,{})]}),"\n",(0,a.jsxs)(e.h2,{id:"空数据",children:[(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#空数据",children:"#"}),"空数据"]}),"\n",(0,a.jsxs)(i.Z,{isMobile:"false",demoId:"_demos_config_Sankey_2",children:[(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-tsx",children:"import type { SankeyProps } from '@sensoro-design/chart';\nimport { Sankey } from '@sensoro-design/chart';\n\nconst values = [\n  {\n    nodes: [\n      {\n        name: '今日巡航次数',\n        value: 160,\n        total: 0,\n        children: [\n          {\n            name: '公共安全',\n            value: 40,\n            total: 0,\n            children: [\n              { name: '高风险', value: 10, total: 0 },\n              { name: '中风险', value: 10, total: 0 },\n              { name: '低风险', value: 10, total: 0 },\n              { name: '无风险', value: 10, total: 0 },\n            ],\n          },\n          {\n            name: '交通安全',\n            value: 40,\n            total: 0,\n            children: [\n              { name: '高风险', value: 10, total: 0 },\n              { name: '中风险', value: 10, total: 0 },\n              { name: '低风险', value: 10, total: 0 },\n              { name: '无风险', value: 10, total: 0 },\n            ],\n          },\n          {\n            name: '市容市政',\n            value: 40,\n            total: 0,\n            children: [\n              { name: '高风险', value: 10, total: 0 },\n              { name: '中风险', value: 10, total: 0 },\n              { name: '低风险', value: 10, total: 0 },\n              { name: '无风险', value: 10, total: 0 },\n            ],\n          },\n          {\n            name: '城市秩序',\n            value: 40,\n            total: 82854,\n            children: [\n              { name: '高风险', value: 10, total: 0 },\n              { name: '中风险', value: 10, total: 0 },\n              { name: '低风险', value: 10, total: 0 },\n              { name: '无风险', value: 10, total: 0 },\n            ],\n          },\n        ],\n      },\n    ],\n  },\n];\n\nconst colors = ['#423CD1', '#E7474D', '#E7AF2C', '#51C2E1', '#3AC583'];\nconst specified = {\n  今日巡航次数: colors[0],\n  公共安全: colors[0],\n  交通安全: colors[0],\n  市容市政: colors[0],\n  城市秩序: colors[0],\n  高风险: colors[1],\n  中风险: colors[2],\n  低风险: colors[3],\n  无风险: colors[4],\n};\n\nfunction Example() {\n  const spec: SankeyProps = {\n    height: 600,\n    data: [\n      {\n        values,\n      },\n    ],\n    color: {\n      type: 'ordinal',\n      range: colors,\n      domain: [],\n      specified,\n    },\n    categoryField: 'name',\n    valueField: 'value',\n    nodeAlign: 'left',\n    nodeWidth: 4,\n    // @ts-expect-error 忽略报错\n    nodeKey: datum => datum.name,\n    nodeHeight: (node) => {\n      return node.depth === 0 ? 160 : 40;\n    },\n    label: {\n      visible: true,\n      offset: 8,\n      formatMethod: (_, datum) => {\n        return `${datum?.name} ${datum?.total?.toLocaleString()}`;\n      },\n      style: {\n        fill: '#F6F9FE',\n        fontSize: 12,\n      },\n    },\n    tooltip: {\n      mark: {\n        visible: false,\n      },\n    },\n\n    link: {\n      style: {\n        fill: 'rgba(246, 249, 254, 0.15)',\n      },\n    },\n\n    emphasis: {\n      enable: true,\n      trigger: 'hover',\n      effect: 'related',\n    },\n  };\n\n  return (\n    <Sankey {...spec} />\n  );\n};\n\nexport default Example;\n"})})}),(0,a.jsx)(r.default,{})]})]})}function u(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,l.ah)(),n.components);return e?(0,a.jsx)(e,Object.assign({},n,{children:(0,a.jsx)(s,n)})):s(n)}let c=u;u.__RSPRESS_PAGE_META={},u.__RSPRESS_PAGE_META["demos%2Fconfig%2FSankey.mdx"]={toc:[{id:"自定义颜色",text:"自定义颜色",depth:2},{id:"空数据",text:"空数据",depth:2}],title:"桑基图",headingTitle:"桑基图",frontmatter:{}}},55457:function(n,e,t){t.r(e),t.d(e,{default:()=>v});var a=t(52676),l=t(90565),o=t(75271);function r(n,e,t){if("function"==typeof t.getChildrenKey){let a=t.getChildrenKey(n,e);if(null!=a)return a}return t.childrenKey}let i=(n,e,t)=>{e(n,t);let a=r(n,t,t),l=n[a];if(l&&Array.isArray(l)){let a={...t,parents:[...t.parents,n],depth:t.depth+1};l.forEach(n=>{i(n,e,a)})}},s=(n,e,t)=>{let a=r(n,t,t),l=n[a];if(l&&Array.isArray(l)){let a={...t,parents:[...t.parents,n],depth:t.depth+1};l.forEach(n=>{s(n,e,a)})}e(n,t)},u={pre:i,post:s,breadth:(n,e,t)=>{let a=[{tree:n,options:t}],l=()=>{if(0===a.length)return;let n=a.shift(),t=n.tree,o=r(t,n.options,n.options);if(t[o]&&Array.isArray(t[o])){let e={...n.options,parents:[...n.options.parents,t],depth:n.options.depth+1},l=t[o].map(n=>({tree:n,options:e}));a.push(...l)}e(t,n.options),l()};l()}},c=[{nodes:[{name:"今日巡航次数",value:160,total:1087875,children:[{name:"公共安全",value:40,total:287875,children:[{name:"高风险",value:10,total:18764},{name:"中风险",value:10,total:22329},{name:"低风险",value:10,total:43093},{name:"无风险",value:10,total:763875}]},{name:"交通安全",value:40,total:200653,children:[{name:"高风险",value:10,total:18764},{name:"中风险",value:10,total:22329},{name:"低风险",value:10,total:43093},{name:"无风险",value:10,total:763875}]},{name:"市容市政",value:40,total:406765,children:[{name:"高风险",value:10,total:18764},{name:"中风险",value:10,total:22329},{name:"低风险",value:10,total:43093},{name:"无风险",value:10,total:763875}]},{name:"城市秩序",value:40,total:82854,children:[{name:"高风险",value:10,total:18764},{name:"中风险",value:10,total:22329},{name:"低风险",value:10,total:43093},{name:"无风险",value:10,total:763875}]}]}]}],d=["#423CD1","#E7474D","#E7AF2C","#51C2E1","#3AC583"],m={今日巡航次数:d[0],公共安全:d[0],交通安全:d[0],市容市政:d[0],城市秩序:d[0],高风险:d[1],中风险:d[2],低风险:d[3],无风险:d[4]};function h(n){let{style:e}=n;return(0,a.jsx)("div",{style:{position:"absolute",width:"100px",visibility:"hidden",backdropFilter:"blur(20px)",background:"rgba(49,64,89,0.35)",padding:16,top:0,left:0,...e},children:"我是 Tooltip"})}let v=function(){let n=o.useRef(null),e=o.useRef(),t=o.useRef(),[r,i]=o.useState({}),s=()=>{let e=n.current,a=[];!function(n,e,t){var a,l;let o=null!=(a=null==t?void 0:t.childrenKey)?a:"children",r=null!=(l=null==t?void 0:t.strategy)?l:"pre",i=null==t?void 0:t.getChildrenKey,s=Array.isArray(n),c=u[r],d={childrenKey:o,depth:0,parents:[],getChildrenKey:i};s?n.forEach(n=>{c(n,e,d)}):c(n,e,d)}(c[0].nodes,n=>{let e=n.name;a.includes(e)||"今日巡航次数"===e||a.push(e)},{strategy:"breadth"}),e&&(t.current=setInterval(()=>{let n=function(n){if(0===n.length)return null;let e=Math.floor(Math.random()*n.length);return n[e]}(a);n&&e.setHovered([{name:n}])},2e3))},v=()=>{let e=n.current;t.current&&clearInterval(t.current),e&&e.setHovered(null)};return o.useEffect(()=>(e.current=setTimeout(()=>{console.log(n.current);let e=n.current;e&&(s(),e.setTooltipHandler({showTooltip:(n,e,t)=>{if(i(n=>({...n,left:t.event.x+30,top:t.event.y+30})),!t.changePositionOnly)return i(n=>({...n,visibility:"visible"})),0},hideTooltip:()=>(i(n=>({...n,visibility:"hidden"})),0),release:()=>{}}))},500),()=>{e.current&&clearTimeout(e.current),v()}),[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.bQ,{height:600,data:[{values:c}],color:{type:"ordinal",range:d,domain:[],specified:m},categoryField:"name",valueField:"value",nodeAlign:"left",nodeWidth:4,nodeKey:n=>n.name,nodeHeight:n=>0===n.depth?160:40,label:{visible:!0,offset:8,formatMethod(n,e){var t;return`${null==e?void 0:e.name} ${null==e?void 0:null===(t=e.total)||void 0===t?void 0:t.toLocaleString()}`},style:{fill:"#F6F9FE",fontSize:12}},link:{style:{fillOpacity:.3,fill:n=>({gradient:"linear",x0:.2,y0:.5,x1:1,y1:1,stops:[{offset:0,color:m[null==n?void 0:n.source]},{offset:1,color:m[null==n?void 0:n.target]}]})},state:{selected:{fillOpacity:1}}},emphasis:{enable:!0,trigger:"hover",effect:"related"},skipFunctionDiff:!0,ref:n}),(0,a.jsx)(h,{style:r})]})}},49204:function(n,e,t){t.r(e),t.d(e,{default:()=>s});var a=t(52676),l=t(90565);let o=[{nodes:[{name:"今日巡航次数",value:160,total:0,children:[{name:"公共安全",value:40,total:0,children:[{name:"高风险",value:10,total:0},{name:"中风险",value:10,total:0},{name:"低风险",value:10,total:0},{name:"无风险",value:10,total:0}]},{name:"交通安全",value:40,total:0,children:[{name:"高风险",value:10,total:0},{name:"中风险",value:10,total:0},{name:"低风险",value:10,total:0},{name:"无风险",value:10,total:0}]},{name:"市容市政",value:40,total:0,children:[{name:"高风险",value:10,total:0},{name:"中风险",value:10,total:0},{name:"低风险",value:10,total:0},{name:"无风险",value:10,total:0}]},{name:"城市秩序",value:40,total:82854,children:[{name:"高风险",value:10,total:0},{name:"中风险",value:10,total:0},{name:"低风险",value:10,total:0},{name:"无风险",value:10,total:0}]}]}]}],r=["#423CD1","#E7474D","#E7AF2C","#51C2E1","#3AC583"],i={今日巡航次数:r[0],公共安全:r[0],交通安全:r[0],市容市政:r[0],城市秩序:r[0],高风险:r[1],中风险:r[2],低风险:r[3],无风险:r[4]},s=function(){return(0,a.jsx)(l.bQ,{height:600,data:[{values:o}],color:{type:"ordinal",range:r,domain:[],specified:i},categoryField:"name",valueField:"value",nodeAlign:"left",nodeWidth:4,nodeKey:n=>n.name,nodeHeight:n=>0===n.depth?160:40,label:{visible:!0,offset:8,formatMethod:(n,e)=>{var t;return`${null==e?void 0:e.name} ${null==e?void 0:null===(t=e.total)||void 0===t?void 0:t.toLocaleString()}`},style:{fill:"#F6F9FE",fontSize:12}},tooltip:{mark:{visible:!1}},link:{style:{fill:"rgba(246, 249, 254, 0.15)"}},emphasis:{enable:!0,trigger:"hover",effect:"related"}})}}}]);