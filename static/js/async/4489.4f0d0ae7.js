"use strict";(self.webpackChunksensoro_design_charts=self.webpackChunksensoro_design_charts||[]).push([["4489"],{77840:function(e,t,r){r.r(t),r.d(t,{default:()=>F});var l=r(52676),n=r(90565);let a=0;function o(e=""){let t=++a;return`${e}${t}`}var i=r(75271);function s(e,t,r){if("function"==typeof r.getChildrenKey){let l=r.getChildrenKey(e,t);if(null!=l)return l}return r.childrenKey}let u=(e,t,r)=>{t(e,r);let l=s(e,r,r),n=e[l];if(n&&Array.isArray(n)){let l={...r,parents:[...r.parents,e],depth:r.depth+1};n.forEach(e=>{u(e,t,l)})}},p=(e,t,r)=>{let l=s(e,r,r),n=e[l];if(n&&Array.isArray(n)){let l={...r,parents:[...r.parents,e],depth:r.depth+1};n.forEach(e=>{p(e,t,l)})}t(e,r)},d={pre:u,post:p,breadth:(e,t,r)=>{let l=[{tree:e,options:r}],n=()=>{if(0===l.length)return;let e=l.shift(),r=e.tree,a=s(r,e.options,e.options);if(r[a]&&Array.isArray(r[a])){let t={...e.options,parents:[...e.options.parents,r],depth:e.options.depth+1},n=r[a].map(e=>({tree:e,options:t}));l.push(...n)}t(r,e.options),n()};n()}},f=(e,t,r)=>{let l;let n=s(e,r,r),a=t(e,r),o=e[n];if(o&&Array.isArray(o)){let n={...r,parents:[...r.parents,e],depth:r.depth+1};l=o.map(e=>f(e,t,n))}return{...a,[n]:l}},h=(e,t,r)=>{let l;let n=s(e,r,r),a=e[n];if(a&&Array.isArray(a)){let n={...r,parents:[...r.parents,e],depth:r.depth+1};l=a.map(e=>h(e,t,n))}return{...t(e,r),[n]:l}},c=(e,t,r)=>{let l;if(!t(e,r))return;let n=s(e,r,r),a=e[n];return a&&Array.isArray(a)&&(l=a.map(l=>c(l,t,{...r,parents:[...r.parents,e],depth:r.depth+1})).filter(e=>!!e)),{...e,[n]:l}},y=(e,t,r)=>{let l;let n=s(e,r,r),a=e[n];if(a&&Array.isArray(a)&&(l=a.map(l=>y(l,t,{...r,parents:[...r.parents,e],depth:r.depth+1})).filter(e=>!!e)),t(e,r))return{...e,[n]:l}},v=(e,t,r)=>{if(t(e,r))return e;let l=s(e,r,r),n=e[l];if(n&&Array.isArray(n))for(let l=0,a=n.length;l<a;l++){let a=v(n[l],t,{...r,parents:[...r.parents,e],depth:r.depth+1});if(a)return a}},m=(e,t,r)=>{let l=s(e,r,r),n=e[l];if(n&&Array.isArray(n))for(let l=0,a=n.length;l<a;l++){let a=m(n[l],t,{...r,parents:[...r.parents,e],depth:r.depth+1});if(a)return a}if(t(e,r))return e},k={pre:v,post:m,breadth:(e,t,r)=>{let l=[{tree:e,options:r}],n=()=>{if(0===l.length)return;let e=l.shift(),r=e.tree,a=s(r,e.options,e.options);if(r[a]&&Array.isArray(r[a])){let t=r[a].map(t=>({tree:t,options:{...e.options,parents:[...e.options.parents,r],depth:e.options.depth+1}}));l.push(...t)}return t(r,e.options)?r:n()};return n()}};var g={foreach:function(e,t,r){var l,n;let a=null!=(l=null==r?void 0:r.childrenKey)?l:"children",o=null!=(n=null==r?void 0:r.strategy)?n:"pre",i=null==r?void 0:r.getChildrenKey,s=Array.isArray(e),u=d[o],p={childrenKey:a,depth:0,parents:[],getChildrenKey:i};s?e.forEach(e=>{u(e,t,p)}):u(e,t,p)}};let A=[{nodes:[{key:o(),name:"今日巡航次数",value:160,total:1087875,children:[{key:o(),name:"公共安全",value:40,total:287875,children:[{key:o(),name:"高风险",value:10,total:18764},{key:o(),name:"中风险",value:10,total:22329},{key:o(),name:"低风险",value:10,total:43093},{key:o(),name:"无风险",value:10,total:763875}]},{key:o(),name:"交通安全",value:40,total:200653,children:[{key:o(""),name:"高风险",value:10,total:18764},{key:o(),name:"中风险",value:10,total:22329},{key:o(),name:"低风险",value:10,total:43093},{key:o(),name:"无风险",value:10,total:763875}]},{key:o(),name:"市容市政",value:40,total:406765,children:[{key:o(),name:"高风险",value:10,total:18764},{key:o(),name:"中风险",value:10,total:22329},{key:o(),name:"低风险",value:10,total:43093},{key:o(),name:"无风险",value:10,total:763875}]},{key:o(),name:"城市秩序",value:40,total:82854,children:[{key:o(),name:"高风险",value:10,total:18764},{key:o(),name:"中风险",value:10,total:22329},{key:o(),name:"低风险",value:10,total:43093},{key:o(),name:"无风险",value:10,total:763875}]}]}]}],b=["#423CD1","#E7474D","#E7AF2C","#51C2E1","#3AC583"],C={高风险:b[1],中风险:b[2],低风险:b[3],无风险:b[4]};function x(e){let{style:t}=e;return(0,l.jsx)("div",{style:{position:"absolute",width:"100px",visibility:"hidden",backdropFilter:"blur(20px)",background:"rgba(49,64,89,0.35)",padding:16,top:0,left:0,...t},children:"我是 Tooltip"})}g.foreach(A[0].nodes,e=>{let t=e.name;C[t]||(C[t]=b[0])});let F=function(){let e=i.useRef(["公共安全","交通安全","市容市政","城市秩序"]),t=i.useRef(null),r=i.useRef(),a=i.useRef(null),[s,u]=i.useState({}),p=()=>{let e=t.current;a.current&&(clearInterval(a.current),a.current=null),a.current&&clearInterval(a.current),e&&e.setHovered(null)},d=()=>{let r=t.current;if(!r)return;let l=e.current;p(),a.current=setInterval(()=>{let e=function(e){if(0===e.length)return null;let t=Math.floor(Math.random()*e.length);return e[t]}(l);e&&r.setHovered([{name:e}])},2e3)},f=()=>{p()},h=()=>{d()};return i.useEffect(()=>(r.current=setTimeout(()=>{console.log(t.current);let e=t.current;e&&(d(),e.on("pointerenter",{level:"chart"},f),e.on("pointerleave",{level:"chart"},h),e.setTooltipHandler({showTooltip:(e,t,r)=>{if(u(e=>({...e,left:r.event.x+30,top:r.event.y+30})),!r.changePositionOnly)return u(e=>({...e,visibility:"visible"})),0},hideTooltip:()=>(u(e=>({...e,visibility:"hidden"})),0),release:()=>{}}))},500),()=>{t.current&&(t.current.off("pointerenter",f),t.current.off("pointerleave",h)),r.current&&clearTimeout(r.current),p()}),[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.bQ,{height:600,data:[{id:"sankey-data",values:A}],color:{type:"ordinal",range:b,domain:[],specified:C},categoryField:"name",valueField:"value",nodeAlign:"left",nodeWidth:4,nodeKey:e=>e.name,nodeHeight:e=>0===e.depth?160:40,node:{style:{boundsPadding:[0,20,0,20],fill:e=>2!==e.depth?b[0]:C[e.key]}},label:{visible:!0,offset:-12,formatMethod(e,t){var r;return`${null==t?void 0:t.name} ${null==t?void 0:null===(r=t.total)||void 0===r?void 0:r.toLocaleString()}`},style:{fill:"#F6F9FE",fontSize:12}},link:{style:{fillOpacity:.3,fill:e=>[2,3].includes(e.parents.length)?{gradient:"linear",x0:.1,y0:1,x1:1,y1:1,stops:[{offset:0,color:C[null==e?void 0:e.source]||b[0]},{offset:1,color:C[null==e?void 0:e.target]||b[0]}]}:b[0]},state:{selected:{fillOpacity:1}}},emphasis:{enable:!0,trigger:"hover",effect:"related"},skipFunctionDiff:!0,ref:t,onClick:e=>{var r;if((null===(r=e.node)||void 0===r?void 0:r.type)==="rect"){let{datum:r}=e,l=t.current;if(!l)return;r.children||(console.log(e),g.foreach(A[0].nodes,e=>{r.datum.name===e.name&&(e.children=[{key:o(),name:"测试节点",value:5,total:1e3}])}),l.updateData("sankey-data",A))}},onDblClick:e=>{console.log(e)}}),(0,l.jsx)(x,{style:s})]})}}}]);